# Forked from Alpine to build Plasma 5.17 pre-release
pkgname=kwin
pkgver=5.16.90
pkgrel=2
pkgdesc="An easy to use, but flexible, composited Window Manager"
arch="all"
url="https://www.kde.org/workspaces/plasmadesktop/"
license="GPL-2.0-or-later AND (GPL-2.0-only OR GPL-3.0-only) AND LGPL-2.1-only"
depends="qt5-qtwayland qt5-qtmultimedia kirigami2 xorg-server-xwayland"
depends_dev="qt5-qtbase-dev qt5-qtdeclarative-dev qt5-qtscript-dev qt5-qtsensors-dev qt5-qtx11extras-dev kconfig-dev kconfigwidgets-dev kcoreaddons-dev kcrash-dev kglobalaccel-dev ki18n-dev kinit-dev knotifications-dev kpackage-dev plasma-framework-dev kwidgetsaddons-dev kwindowsystem-dev kiconthemes-dev kidletime-dev kwayland-dev kcompletion-dev kdeclarative-dev kcmutils-dev kio-dev ktextwidgets-dev knewstuff-dev kservice-dev kxmlgui-dev kactivities-dev kdecoration-dev kscreenlocker-dev breeze-dev libepoxy-dev mesa-dev wayland-dev xcb-util-cursor-dev xcb-util-image-dev xcb-util-wm-dev libinput-dev eudev-dev libdrm-dev mesa-gbm fontconfig-dev libxkbcommon-dev libxi-dev"
makedepends="$depends_dev extra-cmake-modules qt5-qttools-dev qt5-qttools-static kdoctools-dev"
source="https://download.kde.org/unstable/plasma/$pkgver/$pkgname-$pkgver.tar.xz
	0001-Software-rotation-orient-the-screen-regardless-of-wh.patch
	0001-Consider-DSI-connector-display-to-be-internal.patch
	0001-debug-patch.patch"
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang"
options="!check" # Broken

build() {
	cmake \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_TESTING=false
	make
}

package() {
	DESTDIR="$pkgdir" make install
}
sha512sums="bb979ab530bef8d22f3ac7c7388f98412a09eb27d260542a9ce81cf6ec3719573bcfce0ddf1ef98fb57807e24edf20bc35317710515ca44e11db048db9e16418  kwin-5.16.90.tar.xz
7bfc048cb55408996a5ebd5c639c31fde3717cf78e2b4145f830058c8ba9a92e2253e38f65ee37d9c0d9bc20a2442f238721e12d5695897327b4a17242f8d670  0001-Software-rotation-orient-the-screen-regardless-of-wh.patch
03aacf6227e9ec612bf47078e40ff0942ee953b7feef9a71080136408074caf8fc06535cd13ab2391cdd3d6b0b94fdd1cb9b7b997ea488a1f7641f9f77028326  0001-Consider-DSI-connector-display-to-be-internal.patch
a3b5780ea4ef7d6ed897de5eec3a97263fc1284c46b36cea764958780e48b7b14dbdf61003ef50b94591c2d7f58113c928fcca8fe8a4046dfad1ccca257a060f  0001-debug-patch.patch"
