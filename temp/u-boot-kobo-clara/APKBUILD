# Downstream u-boot for the kobo clara
pkgname=u-boot-kobo-clara
pkgver=2016.03
pkgrel=0
_ubootversion="5af329fef886e21b777426d7bf5c6162e2317de7"
pkgdesc="u-boot bootloader for the Purism Librem5 devkit"
url="https://github.com/pmsourcedump/kobo_clara_uboot"
arch="armv7"
license="GPL-2.0-or-later"
makedepends="$depends_dev bc dtc python3-dev swig binutils coreutils zlib-dev"
options="!check !tracedeps"
source="
	uboot-kobo-clara-${_ubootversion}.tar.gz::https://github.com/pmsourcedump/kobo_clara_uboot/archive/${_ubootversion}.tar.gz
	"
builddir="$srcdir"/kobo_clara_uboot-${_ubootversion}

build() {
	touch include/config.h
	LC_ALL=C date +'#define U_BOOT_DATE "%b %d %C%y"' > include/timestamp_autogenerated.h
	LC_ALL=C date +'#define U_BOOT_TIME "%T"' >> include/timestamp_autogenerated.h
	export HOSTCC=gcc
	make mx6sll_e70q02_defconfig
	make all
}

package() {
	install -D "$builddir"/u-boot.imx "$pkgdir"/usr/share/firmware/kobo-clara/u-boot.imx
}

sha512sums="1712f5a922b44a8b80e49e00969f0948cd62864adedfb419d9d2f6ccf765b432f8632787f7c6d1502ec0aa6afb7b27bf4193733c2345ff4a0378b43b5b10643a  uboot-kobo-clara-5af329fef886e21b777426d7bf5c6162e2317de7.tar.gz"
